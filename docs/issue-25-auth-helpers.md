# Issue 25: Supabase Auth Helpers 正攻法導入\n\n## 目的\n- localStorage だけに保持されているセッションを SSR / middleware でも一貫して判定できるようにする。\n- HttpOnly Cookie を `@supabase/ssr` の仕組みで読み書きし、middleware で `getUser()` が成功する状態を確立。\n\n## 対応概要\n1. ブラウザクライアントを `createBrowserClient` に変更 (persistSession, autoRefreshToken 有効)\n2. 既存 `getSupabaseClient()` をラップし再利用 API を保つ or 新関数導入\n3. middleware: 余剰な早期リダイレクト(手動 cookie 判定)を撤廃し公式パターンへ寄せる\n4. ログインページ: signIn 後即 `router.refresh()` し、middleware に委譲\n5. ログアウト API / アクション準備（本 Issue では最小: サインアウト処理のみ）\n\n## 確認項目\n- 未ログイン /dashboard -> /login リダイレクト\n- ログイン成功後 /dashboard へ到達\n- onboarding 未完 -> /onboarding 強制\n- onboarding 完了 -> /login で /profile へ\n\n## 後続候補\n- Server Actions 経由サインイン最適化\n- /api/profile でのユーザーID検証テスト追加\n- E2E テスト (実サインアップ) 自動化\n
